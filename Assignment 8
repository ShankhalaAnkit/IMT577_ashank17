---------------------------------------------------------------
-- VIEW 1 FOR QUESION 1.1
---------------------------------------------------------------

CREATE VIEW VIEW_STORE_PERFORMANCE
AS
SELECT A.STORENUMBER,A.MONTH_NUM_IN_YEAR,A.MONTH_NAME,A.YEAR,A.SALES_TARGET_AMOUNT,B.SALEAMOUNT
FROM
(SELECT DS.STORENUMBER,DD.MONTH_NUM_IN_YEAR,DD.MONTH_NAME,DD.YEAR,ROUND(SUM(FSSA.SALESTARGETAMOUNT),0) AS SALES_TARGET_AMOUNT
FROM VIEW_FACT_SRCSALESTARGET FSSA
INNER JOIN VIEW_DIM_STORE DS
ON DS.DIMSTOREID = FSSA.DIMSTOREID
INNER JOIN 
VIEW_DIM_DATE DD
ON DD.DATE_PKEY = FSSA.DIMTARGETDATEID
WHERE FSSA.DIMSTOREID in (6,4)
GROUP BY 1,2,3,4
ORDER BY 2) AS A
INNER JOIN 
(SELECT DS.STORENUMBER,DD.MONTH_NUM_IN_YEAR,DD.MONTH_NAME,DD.YEAR,ROUND(SUM(FSA.SALEAMOUNT),0) AS SALEAMOUNT
FROM VIEW_FACT_SALESACTUAL FSA
INNER JOIN VIEW_DIM_STORE DS
ON DS.DIMSTOREID = FSA.DIMSTOREID
INNER JOIN 
VIEW_DIM_DATE DD
ON DD.DATE_PKEY = FSA.DIMSALEDATEID
WHERE FSA.DIMSTOREID in (6,4)
GROUP BY 1,2,3,4
ORDER BY 2) AS B 
ON A.STORENUMBER=B.STORENUMBER AND A.MONTH_NUM_IN_YEAR=B.MONTH_NUM_IN_YEAR AND A.MONTH_NAME=B.MONTH_NAME AND A.YEAR=B.YEAR
ORDER BY 1,2,4;

---------------------------------------------------------------
-- VIEW 2 FOR QUESION 1.3
---------------------------------------------------------------

CREATE VIEW VIEW_PRODUCT_PERFORMANCE
AS
SELECT DP.SOURCEPRODUCTID AS PRODUCTID,DP.PRODUCTNAME AS PRODUCTNAME,DP.PRODUCTTYPE AS PRODUCTTYPE,DP.PRODUCTCATEGORY AS PRODUCTCATEGORY
,A.DIMSALEdateid,VDD.DAY_NAME,VDD.YEAR,A.ACTUAL_PROD_SALE, ROUND(VPFS.PRODUCTTARGETARGETSALESQUANTITY,0) AS PRODUCT_SALE_QTY_TARGET
FROM (SELECT DIMPRODUCTID,DIMSALEdateid,ROUND(SUM(SALEQUANTITY),0) as ACTUAL_PROD_SALE FROM VIEW_FACT_SALESACTUAL
GROUP BY 1,2) AS A
INNER JOIN 
VIEW_FACT_PRODUCTSALESTARGET VPFS 
ON VPFS.DIMPRODUCTID = A.DIMPRODUCTID AND A.DIMSALEDATEID = VPFS.DIMTARGETDATEID
INNER JOIN DIM_PRODUCT DP
ON DP.DIMPRODUCTID=A.DIMPRODUCTID
INNER JOIN 
VIEW_DIM_DATE AS VDD
ON VDD.DATE_PKEY = A.DIMSALEdateid;


CREATE VIEW AnnualStoreProfit AS
SELECT VDS.StoreNumber, VDD.YEAR, SUM(VFSA.SaleTotalProfit) AS TotalProfit
FROM View_Fact_SalesActual VFSA
JOIN Dim_Date VDD on VFSA.DimSaleDateID = VDD.DATE_PKEY
JOIN Dim_Store VDS on VFSA.DimStoreID = VDS.DimStoreID
WHERE VFSA.DimStoreID IN (SELECT VDS.DimStoreID FROM Dim_store VDS WHERE VDS.StoreNumber = 5 OR VDS.StoreNumber = 8)
GROUP BY VDD.YEAR, VDS.StoreNumber
